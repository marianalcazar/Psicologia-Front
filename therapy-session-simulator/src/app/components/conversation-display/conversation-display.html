<!-- src/app/features/therapy-session/components/conversation-display/conversation-display.component.html -->

<div class="conversation-container">
  <!-- Header con información de sesión -->
  

  <!-- Área de mensajes -->
  <div class="messages-area" #messagesArea>
    <div class="loading-state" *ngIf="isLoading">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Cargando sesión...</p>
    </div>

    <!-- Mensajes -->
    <div class="message" *ngFor="let message of messages" [class.patient-message]="message.sender === 'paciente'"
      [class.therapist-message]="message.sender === 'terapeuta'" [@messageAnimation]>
      <div class="message-bubble">
        <div class="message-header">
          <span class="sender-label">
            <mat-icon>{{ message.sender === 'paciente' ? 'person' : 'psychology' }}</mat-icon>
            {{ message.sender === 'paciente' ? 'Paciente' : 'Tú (Terapeuta)' }}
          </span>
          <span class="message-time">{{ message.timestamp }}</span>
        </div>
        <div class="message-text">{{ message.text }}</div>
      </div>
    </div>

    <!-- Indicador de que el paciente está escribiendo -->
    <div class="typing-indicator" *ngIf="isSending">
      <div class="typing-bubble">
        <span class="sender-label">
          <mat-icon>person</mat-icon>
          Paciente está escribiendo
        </span>
        <div class="typing-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    </div>

    <!-- Estado vacío -->
    <div class="empty-state" *ngIf="messages.length === 0 && !isLoading">
      <mat-icon>chat_bubble_outline</mat-icon>
      <h3>Inicia la sesión</h3>
      <p>Escribe tu primer mensaje para comenzar la sesión terapéutica</p>
    </div>
  </div>

  <!-- Área de entrada -->
  <div class="input-area" [class.disabled]="isLoading || isSending">
    <mat-form-field appearance="outline" class="message-input">
      <mat-label>Tu respuesta como terapeuta...</mat-label>
      <textarea matInput [(ngModel)]="therapistMessage" (keydown.control.enter)="onSendMessage()"
        [disabled]="isLoading || isSending" rows="3" placeholder="Escribe tu respuesta terapéutica aquí..."
        maxlength="1000">
      </textarea>
      <mat-hint align="start">Presiona Ctrl+Enter para enviar</mat-hint>
      <mat-hint align="end">{{ therapistMessage.length }}/1000</mat-hint>
    </mat-form-field>

    <div class="action-buttons">
      <button mat-raised-button color="primary" (click)="onSendMessage()"
        [disabled]="!therapistMessage.trim() || isLoading || isSending">
        <mat-spinner diameter="20" *ngIf="isSending"></mat-spinner>
        <mat-icon *ngIf="!isSending">send</mat-icon>
        {{ isSending ? 'Enviando...' : 'Enviar Mensaje' }}
      </button>


    </div>
  </div>